name: CI Tests

on:
  push:
  pull_request:

jobs:
  linux:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Run tests (bash)
        shell: bash
        run: |
          bash run_tests.sh --color || true
          # Ensure non-zero exit propagates for CI result
          bash run_tests.sh

  windows:
    runs-on: windows-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Install MinGW (g++)
        shell: powershell
        run: |
          choco install -y mingw
          echo "C:\\ProgramData\\chocolatey\\lib\\mingw\\tools\\install\\mingw64\\bin" | Out-File -FilePath $env:GITHUB_PATH -Encoding utf8 -Append
      - name: Verify g++
        shell: cmd
        run: g++ --version
      - name: Run tests (batch)
        shell: cmd
        run: |
          call run_tests.bat

